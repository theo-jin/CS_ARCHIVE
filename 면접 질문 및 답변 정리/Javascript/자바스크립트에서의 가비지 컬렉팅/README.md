# 가비지 컬렉팅

## 메모리 생존 주기
다음은 가비지 컬렉션의 대상인 메모리의 생존주기이다. 
### 1.할당한다.
자바스크립트는 변수를 선언할 때 자동으로 메모리를 할당한다.
- 원시 타입의 값들은 스택 영역에 저장   
- 참조 타입의 값은 힙 영역에 저장 
- 그 주소값은 스택 영역에 저장   
- 변수 식별자는 스택 영역 상의 실행 컨텍스트의 렉시컬 환경에 저장

### 2. 사용한다(참조).
v8 엔진에 의해 전역 실행 컨텍스트 렉시컬 환경에 있는 식별자 a, b를 참조합니다.

### 3. 필요 없으면 해제한다.
C 언어나 C++ 언어처럼 수동으로 쓸모없는 메모리 영역을 해제할 수 없습니다. 그것을 자동으로 해주는 게 바로 가비지 컬렉터(GC)입니다. 그렇다면 GC는 어떤 기준으로 메모리 영역을 더 이상 쓸모없다고 판단할까요? 또 어떠한 원리로 가비지 컬렉션이 동작할까요?


## 가비지 컬렉터 정의
가비지 콜렉터는 애플리케이션이 할당한 메모리 공간을 주기적으로 검사하여 더 이상 사용되지 않는 메모리를 해제하는 기능을 말한다.   
더 이상 사용되지 않는 메모리란 간단히 말하자면 어떤 식별자도 참조하지 않는 메모리 공간을 의미한다.  
 자바스크립트는 가비지 콜렉터를 내장하고 있는 매니지드 언어로서 가비지 콜렉터를 통해 메모리 누수를 방지한다. 

가비지 컬렉션 기준
자바스크립트는 도달 가능성(reachability) 이라는 개념을 사용해 메모리 관리를 수행합니다.

‘도달 가능한(reachable)’ 값은 쉽게 말해 어떻게든 접근하거나 사용할 수 있는 값을 의미합니다. 도달 가능한 값은 메모리에서 삭제되지 않습니다.

아래 소개해 드릴값들은 그 태생부터 도달 가능하기 때문에, 명백한 이유 없이는 삭제되지 않습니다.

예시:

현재 함수의 지역 변수와 매개변수
중첩 함수의 체인에 있는 함수에서 사용되는 변수와 매개변수
전역 변수
기타 등등
이런 값은 루트(root) 라고 부릅니다.

루트가 참조하는 값이나 체이닝으로 루트에서 참조할 수 있는 값은 도달 가능한 값이 됩니다.

도달할 수 없는 섬
객체들이 연결되어 섬 같은 구조를 만드는데, 이 섬에 도달할 방법이 없는 경우, 섬을 구성하는 객체 전부가 메모리에서 삭제됩니다.

## 가비지 컬렉터 알고리즘(A.K.A mark-and-sweep )
**내부 알고리즘**
'mark-and-sweep' - 가비지 컬렉션 기본 알고리즘

'가비지 컬렉션' 단계
- 가비지 컬렉터는 루트(root) 정보를 수집하고 이를 'mark(기억)' 한다.
- 루트가 참조하고 있는 모든 객체를 방문하고 이것들을 ‘mark’ 합니다.
- mark 된 모든 객체에 방문하고 그 객체들이 참조하는 객체도 mark 합니다. 한번 방문한 객체는 전부 mark 하기 때문에 같은 객체를 다시 방문하는 일은 없습니다.
- 루트에서 도달 가능한 모든 객체를 방문할 때까지 위 과정을 반복합니다.
- mark 되지 않은 모든 객체를 메모리에서 삭제합니다.


최적화 기법:

- generational collection(세대별 수집) – 객체를 '새로운 객체’와 '오래된 객체’로 나눕니다. 객체 상당수는 생성 이후 제 역할을 빠르게 수행해 금방 쓸모가 없어지는데, 이런 객체를 '새로운 객체’로 구분합니다. 가비지 컬렉터는 이런 객체를 공격적으로 메모리에서 제거합니다. 일정 시간 이상 동안 살아남은 객체는 '오래된 객체’로 분류하고, 가비지 컬렉터가 덜 감시합니다.
- incremental collection(점진적 수집) – 방문해야 할 객체가 많다면 모든 객체를 한 번에 방문하고 mark 하는데 상당한 시간이 소모됩니다. 가비지 컬렉션에 많은 리소스가 사용되어 실행 속도도 눈에 띄게 느려지겠죠. 자바스크립트 엔진은 이런 현상을 개선하기 위해 가비지 컬렉션을 여러 부분으로 분리한 다음, 각 부분을 별도로 수행합니다. 작업을 분리하고, 변경 사항을 추적하는 데 추가 작업이 필요하긴 하지만, 긴 지연을 짧은 지연 여러 개로 분산시킬 수 있다는 장점이 있습니다.
- idle-time collection(유휴 시간 수집) – 가비지 컬렉터는 실행에 주는 영향을 최소화하기 위해 CPU가 유휴 상태일 때에만 가비지 컬렉션을 실행합니다.

https://ko.javascript.info/garbage-collection

https://fe-developers.kakaoent.com/2022/220519-garbage-collection/