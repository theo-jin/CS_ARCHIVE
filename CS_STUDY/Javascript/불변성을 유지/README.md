# 불변성을 유지하려면 어떻게 해야하나.

## 불변성의 정의

- JavaScript에서 불변성이란, 객체가 생성된 이후 그 상태를 변경할 수 없는 것을 의미
- 상태를 변경할 수 없다와 값을 재할당하는 것은 다르다. 상태를 변경할 수 없다는 것은, 객체의 프로퍼티를 변경할 수 없다는 것을 의미
- 불변하다는 말은, 메모리영역 안에서 변경이 불가능하며, 변수에 할당할 때 새로운 값이 만들어져 주소값이 재할당된다는 의미.
- 따라서 복사를 한 뒤 값을 변경하더라도 기존 값에 전혀 영향을 주지 않는다.

## Immutable type vs Mutable type

보통 원시 타입은 불변하다고 하고, 참조 타입은 반대로 변한다고 표현한다.데이터 저장 방식에 차이가 있기 때문이다.

원시 타입의 경우 콜스택의 실제 값에 바로 담기게 되고, 참조 타입은 콜스택의 값이 메모리 주소를 가르키고, 메모리 힙 영역에 실제 값이 담기게 됩니다.
이런 경우 원시 타입은 변수를 재할당하게 되면 이전 값은 가비지 콜렉터의 대상으로, 새로운 값은 콜스택의 값에 담기게 됩니다.
여기서 이루어지는 메모리 재할당은 메모리 영역에는 아무 변동이 생기지 않습니다.이 뜻은 바로 '메모리 힙 영역의 값은 변경되지 않았다. == 불변하다.' 라고 할 수 있습니다.

- 자바스크립트에서는 불변성을 유지하는 값들과 그렇지 않은 값들이 나누어져 있다.
- Boolean, Number, String, null, undefined, Symbol과 같이 원시 타입들은 불변성을 유지하는 타입들이고 Object타입들은 변경가능한 값
- 객체는 객체 내부의 값을 변경하면 객체를 참조하고 있는 다른 값들도 다 같이 변경된다는 의미

## 객체의 불변성 지키기

1. 원시 데이터 타입 사용:숫자나 문자열과 같은 원시 데이터 타입은 불변합니다. 변수 값을 갱신하려면 새로운 값을 할당해야 합니다.

2. 스프레드 문법 사용(1level deps까지만)

- 스프레드 문법을 사용하여 객체를 복사하면 객체가 불변성을 유지
- 객체를 다룰 때는 원본 객체를 직접 수정하지 않고, 새로운 객체를 만들어서 수정합니다. 이를 "깊은 복사"라고 부릅니다.

3. JSON.parse(JSON.stringify(obj))

- JSON 객체를 stringfy 메서드를 통해 직렬화(serialize)한 뒤, parse 메서드를 통해 이를 역직렬화(deserialize)하는 방식.
- JSON.stringfy()는 객체를 json 문자열로 변환하는데, 이 과정에서 원본 객체와의 참조가 모두 끊어지기 때문에 깊은 복사가 가능. 이후 JSON.parse()를 통해 다시 자바스크립트 객체로 만들어주면 복사가 완료.
- 간단한 방법이지만, 객체 내에 함수가 있을 경우 함수를 처리하지 못한다는 단점이 있다. 즉, 간단한 형태의 객체일 때에만 동작

4. 라이브러리
   자바스크립트에서는 불변성을 유지하기 위한 라이브러리들이 있습니다. 대표적으로 'Immutable.js' 나 'immer'가 있다.

## 불변성을 지켜야하는 이유

1️⃣ 예측 가능한 코드:

데이터가 변경되지 않으면 코드의 동작도 예측 가능해집니다. 값이 변하지 않으므로 코드 실행 도중 의도치 않은 변경 사항이 발생할 위험이 줄어듭니다.

2️⃣ 성능 향상:

불변한 데이터는 변할 필요가 없으므로, 변경 시 발생하는 연산 비용을 줄일 수 있습니다. 이로써 코드 실행 속도가 향상됩니다.

3️⃣ 시간 여행 디버깅:

버그를 잡을 때 불변한 데이터는 문제 해결을 더 쉽게 만들어줍니다. 이전 상태로 돌아갈 필요 없이 해당 시점의 데이터를 그대로 분석할 수 있습니다.

## Reference

https://wandering-bear.tistory.com/66#Immutable%--type%--vs%--Mutable%--type
https://velog.io/@co_mong/JS-%EB%B6%88%EB%B3%80%EC%84%B1Immutability
https://jihyundev.tistory.com/20
https://sohyunsaurus.tistory.com/157#google_vignette
